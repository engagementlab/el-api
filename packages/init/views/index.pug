html
  head
    title= 'Engagement Lab CMS'

  body(style='background:#FAFBFB' onload='onload()')
    select(id='package-select', onchange=`changePackage(event)`)
      option(selected=true) load other app
        each item in packages
            option(value=item)=item

    

    div(id='wrapper')
      iframe(id='frame' width='100%', height='100%', style='border:none;' src='http://localhost:3000/cms')

    //- Logic
    script.
        let frameDom;
        function onload() {
          
          const url = 'ws://localhost:3001';
          connection = new WebSocket(url); 
          connection.onerror = error => {
            console.log(`WebSocket error: ${error}`)
          }
          connection.addEventListener('message', function (evt) {
              console.log(`[Websocket] ${evt.data}`);
              if(evt.data === 'loaded') {
                //- A bit hacky but we have to wait for all files to be served
                setTimeout(() =>{
                  document.getElementById('wrapper').appendChild(frameDom);
                }, 5000);
              }
          });
        
        }

        function changePackage(evt) {
          connection.send(JSON.stringify({evt: 'reload', id: evt.target.value}));
          //- Delete frame for now
          frameDom = document.getElementById('frame');
          frameDom.remove();
          //- Show loading indicator

            //- fetch(`http://localhost:3000/api/reload/?packageid=${evt.target.value}`);
        }
