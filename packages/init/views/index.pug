html
  head
    title= 'Engagement Lab CMS'

  body(style='background:#FAFBFB' onload='onload()')
    select(id='package-select', onchange=`changePackage(event)`)
      option(selected=true) load other app
        each item in packages
            option(value=item)=item
    unless loading
      iframe(id='frame' width='100%', height='100%', style='border:none;' src='http://localhost:3000/cms')

    //- Logic
    script.
        function onload() {
          
          const url = 'ws://localhost:3001';
          connection = new WebSocket(url); 
          connection.onerror = error => {
            console.log(`WebSocket error: ${error}`)
          }
          connection.addEventListener('message', function (evt) {
              console.log(`[Websocket] ${evt.data}`);
              if(evt.data === 'loaded') {
                let frame = document.getElementById('frame');
                frame.contentWindow.location.reload();
                frame.style.visibility = 'visible';
              }
          });
        
        }

        function changePackage(evt) {
          connection.send(JSON.stringify({evt: 'reload', id: evt.target.value}));
          document.getElementById('frame').style.visibility = 'hidden';

            //- fetch(`http://localhost:3000/api/reload/?packageid=${evt.target.value}`);
        }
